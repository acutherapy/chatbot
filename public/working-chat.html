<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¯Šæ‰€å®¢æœåŠ©æ‰‹ - å·¥ä½œç‰ˆæœ¬</title>
  <style>
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;margin:0;padding:10px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;}
    .chat-container{width:250px;height:500px;margin:0 auto;background:#fff;border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,.15);overflow:hidden;display:flex;flex-direction:column;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);}
    .chat-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:8px;text-align:center;flex-shrink:0;}
    .language-switch{position:absolute;top:5px;right:5px;background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3);padding:2px 6px;border-radius:10px;text-decoration:none;font-size:8px;transition:background .3s;}
    .language-switch:hover{background:rgba(255,255,255,.3);}
    .chat-header h1{margin:2px 0;font-size:12px;font-weight:600;}
    .chat-header p{margin:2px 0;font-size:9px;}
    .chat-messages{height:380px;overflow-y:auto;padding:8px;background:#f8f9fa;flex:1;}
    .message{display:flex;margin-bottom:6px;align-items:flex-start;}
    .user-message{justify-content:flex-end;}
    .bot-message{justify-content:flex-start;}
    .message-bubble{max-width:80%;padding:6px 8px;border-radius:10px;word-wrap:break-word;font-size:9px;line-height:1.2;}
    .user-message .message-bubble{background:#667eea;color:#fff;}
    .bot-message .message-bubble{background:#fff;color:#333;border:1px solid #e1e5e9;}
    .quick-replies{display:flex;flex-wrap:wrap;gap:3px;margin-top:4px;}
    .quick-reply-btn{background:#667eea;color:#fff;border:none;padding:3px 6px;border-radius:8px;cursor:pointer;font-size:7px;transition:background .3s;}
    .quick-reply-btn:hover{background:#5a6fd8;}
    .chat-input{padding:8px;background:#fff;border-top:1px solid #e1e5e9;flex-shrink:0;}
    .input-wrapper{display:flex;gap:4px;}
    .message-input{flex:1;padding:6px 8px;border:1px solid #e1e5e9;border-radius:12px;font-size:9px;outline:none;}
    .message-input:focus{border-color:#667eea;}
    .send-btn{background:#667eea;color:#fff;border:none;width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:8px;}
    .send-btn:hover{background:#5a6fd8;}
    .send-btn:disabled{background:#ccc;cursor:not-allowed;}
    .loading{text-align:center;color:#666;font-style:italic;}
  </style>
</head>
<body>
<div class="chat-container">
  <div class="chat-header">
    <!-- è‹±æ–‡é“¾æ¥å›é¦–é¡µ -->
    <a href="/index.html" class="language-switch">English</a>
    <div class="bot-avatar">
      <img src="https://cdn-icons-png.flaticon.com/512/2785/2785482.png"
           alt="é’ˆç¸åŠ©æ‰‹"
           style="width:60px;height:60px;border-radius:50%;margin-bottom:10px;">
    </div>
    <h1>ğŸŒ¿ ç¸å®å® - æ‚¨çš„å¥åº·å‘å¯¼</h1>
    <p>åœ¨çº¿æœåŠ¡ | æ™ºèƒ½é—®ç­”</p>
  </div>

  <div class="chat-messages" id="chatMessages">
    <div class="message bot-message">
      <div class="message-bubble">
        <p>ğŸ‘‹ æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„è¯Šæ‰€ï¼</p>
        <p>æˆ‘æ˜¯é’ˆç¸åŠ©æ‰‹ï¼Œæ‚¨çš„ä¸“å±å¥åº·å‘å¯¼ï¼Œå¯ä»¥ä¸ºæ‚¨æä¾›ï¼š</p>
        <ul>
          <li>ğŸ“‹ æœåŠ¡å’¨è¯¢</li>
          <li>ğŸ“… é¢„çº¦å®‰æ’</li>
          <li>ğŸ¥ è¯Šæ‰€ä¿¡æ¯</li>
          <li>ğŸ’¡ å¥åº·å»ºè®®</li>
        </ul>
        <p>è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ</p>
      </div>
    </div>

    <!-- é¦–é¡µå¿«æ·é”® -->
    <div class="quick-replies" id="quickReplies">
      <button class="quick-reply-btn" data-query="é¢„çº¦æœåŠ¡">ğŸ“… é¢„çº¦æœåŠ¡</button>
      <button class="quick-reply-btn" data-query="æŸ¥çœ‹æœåŠ¡">ğŸ“‹ æŸ¥çœ‹æœåŠ¡</button>
      <button class="quick-reply-btn" data-query="è¯Šæ‰€åœ°å€">ğŸ“ è¯Šæ‰€ä¿¡æ¯</button>
      <button class="quick-reply-btn" data-query="è¥ä¸šæ—¶é—´">ğŸ•’ è¥ä¸šæ—¶é—´</button>
    </div>
  </div>

  <div class="chat-input">
    <div class="input-wrapper">
      <input type="text" id="messageInput" class="message-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." maxlength="1000">
      <button id="sendBtn" class="send-btn" onclick="sendMessage()">ğŸ“¤</button>
    </div>
  </div>
</div>

<script>
let isTyping=false;

function addMessage(content,sender){
  const box=document.createElement('div');
  box.className=`message ${sender}-message`;
  const bubble=document.createElement('div');
  bubble.className='message-bubble';
  bubble.innerHTML=content.replace(/\n/g,'<br>');
  box.appendChild(bubble);
  document.getElementById('chatMessages').appendChild(box);
  if(sender==='user'){document.getElementById('quickReplies').style.display='none';}
  document.getElementById('chatMessages').scrollTop=document.getElementById('chatMessages').scrollHeight;
}

function showLoading(){
  const ld=document.createElement('div');
  ld.className='message bot-message';
  ld.id='loadingMessage';
  ld.innerHTML='<div class="message-bubble loading">æ­£åœ¨æ€è€ƒä¸­...</div>';
  document.getElementById('chatMessages').appendChild(ld);
}
function hideLoading(){const l=document.getElementById('loadingMessage');if(l)l.remove();}

async function sendMessage(){
  const input=document.getElementById('messageInput');
  const msg=input.value.trim();
  if(!msg||isTyping)return;
  addMessage(msg,'user');input.value='';showLoading();isTyping=true;
  try{
    const res=await fetch('/chat/message',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg,userId:'web_cn_'+Date.now(),sessionId:'session_cn_'+Date.now()})});
    const data=await res.json();
    if(data.success){addMessage(data.data.message,'bot');if(data.data.quickReplies)renderQuickReplies(data.data.quickReplies);else renderDefaultQR();}
    else addMessage('æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›å¤ï¼Œè¯·ç¨åå†è¯•ã€‚','bot');
  }catch(e){console.error(e);addMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚','bot');}
  finally{hideLoading();isTyping=false;}
}

function sendQuickReply(text){document.getElementById('messageInput').value=text;sendMessage();}
window.sendQuickReply=sendQuickReply;

function renderQuickReplies(list){
  const wrap=document.getElementById('quickReplies');
  wrap.innerHTML='';
  list.forEach(item=>{
    const btn=document.createElement('button');
    btn.className='quick-reply-btn';
    btn.textContent=item.title||item;
    btn.addEventListener('click',()=>sendQuickReply(item.payload||item.title||item));
    wrap.appendChild(btn);
  });
  wrap.style.display='flex';
}
function renderDefaultQR(){
  const wrap=document.getElementById('quickReplies');
  wrap.innerHTML=`<button class="quick-reply-btn" data-query="è¥ä¸šæ—¶é—´">ğŸ•’ è¥ä¸šæ—¶é—´</button>
                  <button class="quick-reply-btn" data-query="é¢„çº¦æœåŠ¡">ğŸ“… é¢„çº¦æœåŠ¡</button>
                  <button class="quick-reply-btn" data-query="è¯Šæ‰€åœ°å€">ğŸ“ è¯Šæ‰€åœ°å€</button>`;
  wrap.style.display='flex';
}

document.addEventListener('DOMContentLoaded',()=>{
  renderDefaultQR();
  document.getElementById('quickReplies').addEventListener('click',e=>{
    const btn=e.target.closest('.quick-reply-btn');
    if(btn)sendQuickReply(btn.dataset.query||btn.textContent.replace(/[ğŸ“…ğŸ“‹ğŸ“ğŸ•’]/g,'').trim());
  });
});
document.getElementById('messageInput').addEventListener('keypress',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}
});
document.getElementById('messageInput').addEventListener('input',function(){
  document.getElementById('sendBtn').disabled=!this.value.trim()||isTyping;
});
</script>
</body>
</html>
